<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="sm-news-item">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      a:hover {
        text-decoration: none;
      }
      .sm-news-date {
        @apply(--paper-font-body1);
      }
      .news-item-title {
        @apply(--paper-font-headline);
        max-height: 4em;
        overflow-y: hidden;
      }
      .news-item-content {
        @apply(--layout-flex);
        float: left;
        height: 15em;
        overflow-y: hidden;
      }
      .news-item-image {
        background-size: cover;
        background-position-x: 50%;
        width: 100px;
        opacity: .3;
        transition: opacity .5s ease;
      }
      :host:hover .news-item-image {
        opacity: 1;
      }
      paper-card.news-item {
        @apply(--layout-horizontal);
      }
      paper-card {
        --paper-card-content: {
          @apply(--paper-font-body2);
        }
        --paper-card-header-image-text: {
          color: white;
          text-shadow: black 0 0 2px, black 0 0 4px, black 0 0 6px, black 0 0 8px, black 0 0 24px;
        }
      }
    </style>

    <a href="{{link}}" onclick="{{app.onClickOpenReadableLink(event);}}">
      <paper-card class="news-item">
        <div class="news-item-content">
          <div class="card-content">
            <div class="news-item-title">{{title}}</div>
            <div class="sm-news-date">{{fromNow(pubDate)}}</div>
            <div class="news-item-description">{{description}}</div>
          </div>
        </div>
        <div class="news-item-image" style="background-image: url('{{enclosureUrl}}');">
        </div>
      </paper-card>
    </a>
  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'sm-news-item',

        properties: {
          item: {
            type: Object,
          },
          link: {
            type: String
          },
          enclosureUrl: {
            type: String
          },
          title: {
            type: String
          },
          description: {
            type: String
          },
          pubDate: {
            type: Date
          }
        },

        ready: function() {
          this.link = this.item.querySelector('link').textContent;
          var enclosure = this.item.querySelector('enclosure');
          this.enclosureUrl = enclosure && enclosure.getAttribute('url') || null;
          this.title = this.item.querySelector('title').innerHTML;
          var description = this.item.querySelector('description').textContent;
          this.description = new DOMParser().parseFromString(description, "text/html").body.textContent;
          this.pubDate = this.item.querySelector('pubDate').innerHTML;
        },

        fromNow: function(pubDate) {
          //return pubDate;
          return moment(new Date(pubDate)).fromNow();
        }
      });
    })();
  </script>
</dom-module>
